# Weekly Egg Logging Indicator - Product Requirements Document

## Overview
Add a visual indicator to The Daily Yolk app showing egg logging status for the past 7 days (6 previous days + today). This feature helps users quickly see their recent logging consistency and identify any missed days.

## User Story
**As a user**, I want to see at a glance which days in the past week I've logged eggs, so that I can identify any missed days and maintain consistent tracking.

## Requirements

### Visual Design

#### Layout
- Position the week indicator between the header ("ðŸ¥š The Daily Yolk") and the date selection section
- Display as a horizontal row of 7 squares/indicators
- Responsive design that works on both mobile and desktop (but prioritize mobile)
- Maintain 16px padding consistent with existing sections

#### Day Indicators
- **7 squares** representing the last 6 days plus today (Monday through Sunday format)
- **Square specifications**:
  - Size: 40x40px on mobile, 45x45px on desktop
  - Border radius: 8px for rounded corners
  - Equal spacing between squares (use CSS Grid with gap)
  - Display day number (22, 23, 24, etc.) centered in each square

#### Visual States
- **Today** (rightmost square):
  - Yellow border (3px solid #FFD700)
  - Background: #1A1A1A (matches app dark theme)
  - Text: White (#FFFFFF)
  - Slightly thicker border to distinguish as "today"

- **Days with eggs logged**:
  - Green background (#28A745) 
  - White text (#FFFFFF)
  - No border needed

- **Days without eggs logged**:
  - Gray background (#333333)
  - Light gray text (#CCCCCC)
  - Subtle indication these days are empty

- **Future dates** (should not appear in this 7-day view):
  - Not applicable - only show past 6 days + today

#### Responsive Behavior
- Mobile (â‰¤480px): Squares 35x35px, font-size 14px
- Desktop (>480px): Squares 40x40px, font-size 16px
- Maintain proportional spacing across all screen sizes

### Functional Requirements

#### Data Source
- Query existing Google Sheets data via new API endpoint
- Check Column B (Date Eaten) for entries in the past 7 days
- No need to query quantities or preparation styles - only presence/absence of entries

#### API Specification
Create new endpoint: `/api/get-recent-entries.js`

**Request:**
- Method: GET
- No parameters required
- Use existing Google Sheets authentication

**Response Format:**
```json
{
  "success": true,
  "weekData": [
    { "date": "2025-07-22", "hasEntries": true, "dayNumber": 22 },
    { "date": "2025-07-23", "hasEntries": true, "dayNumber": 23 },
    { "date": "2025-07-24", "hasEntries": false, "dayNumber": 24 },
    { "date": "2025-07-25", "hasEntries": true, "dayNumber": 25 },
    { "date": "2025-07-26", "hasEntries": true, "dayNumber": 26 },
    { "date": "2025-07-27", "hasEntries": true, "dayNumber": 27 },
    { "date": "2025-07-28", "hasEntries": false, "dayNumber": 28 }
  ]
}
```

**Error Response:**
```json
{
  "success": false,
  "error": "Failed to fetch recent entries"
}
```

#### Loading Behavior
- Fetch week data when app loads (after DOM ready)
- Show loading state: gray squares with subtle pulse animation
- If API fails: show all squares as gray (graceful degradation)
- No retry logic needed - user can refresh page if needed

#### Update Behavior
- **After successful egg submission**: Automatically update the week indicator
- Update today's square to show green (has entries) if it was previously gray
- No need to refetch all 7 days - just update today's status locally

#### No Interaction Required
- Week indicator is **view-only** - no click handlers needed
- Purely informational display
- Does not affect any other app functionality

### Technical Implementation

#### Frontend Changes (index.html)
1. **HTML Structure** (add after header, before date section):
```html
<div class="week-indicator-section">
  <div class="week-grid" id="weekGrid">
    <!-- 7 day squares generated by JavaScript -->
  </div>
</div>
```

2. **CSS Additions** (~40 lines):
- `.week-indicator-section` - container styling
- `.week-grid` - CSS Grid layout for 7 columns
- `.day-square` - individual square styling
- `.day-square.has-entries` - green state
- `.day-square.no-entries` - gray state  
- `.day-square.today` - orange border for today
- Responsive breakpoints for mobile/desktop

3. **JavaScript Functions** (~60 lines):
- `fetchWeekData()` - API call to get recent entries
- `renderWeekIndicator(weekData)` - populate the 7 squares
- `updateTodayIndicator()` - called after successful submission
- `showWeekLoadingState()` - loading animation

#### Backend Changes
1. **New API Endpoint**: `/api/get-recent-entries.js`
- Use existing Google Auth setup (same as submit-entry.js)
- Query Google Sheets for dates in past 7 days
- Return simplified hasEntries boolean for each day
- Handle timezone considerations (use user's local timezone)

#### Google Sheets Query Logic
```javascript
// Pseudo-code for the API endpoint
const today = new Date();
const sevenDaysAgo = new Date(today - 6 * 24 * 60 * 60 * 1000);

// Query Column B (Date Eaten) for date range
const range = 'Sheet1!B:B';
const response = await sheets.spreadsheets.values.get({
  spreadsheetId: SHEET_ID,
  range: range,
});

// Process dates and return hasEntries status for each day
```

### Performance Requirements
- Initial week data load: <2 seconds
- No impact on existing form submission speed
- Minimal additional bandwidth (< 1KB response)
- Graceful handling of API timeout/failures

### Error Handling
- **API unavailable**: Show all squares as gray, app remains functional
- **Invalid date data**: Skip problematic entries, show remaining days
- **Network timeout**: Default to gray squares after 3 seconds
- **No impact on core functionality**: Egg submission should work even if week indicator fails

### Accessibility
- **Semantic HTML**: Use appropriate ARIA labels
- **Screen reader support**: 
  - `aria-label="Weekly egg logging status"`
  - Individual squares: `aria-label="July 22nd: Eggs logged"` or `"July 22nd: No eggs logged"`
- **Keyboard navigation**: Not interactive, so no focus management needed
- **Color contrast**: Ensure green/gray squares meet WCAG AA standards

### Testing Scenarios

#### Happy Path
1. User opens app â†’ Week indicator loads and shows mixed green/gray squares
2. User submits egg entry â†’ Today's square turns green
3. User refreshes â†’ Week data persists correctly

#### Edge Cases
1. **New user** (no historical data): All squares show gray except today if entries exist
2. **Date boundary**: Test behavior at midnight when "today" changes
3. **Partial week of data**: Handle weeks where user has <7 days of historical data
4. **Multiple entries per day**: Single day with 3 separate egg entries should still show as single green square

#### Error Scenarios
1. Google Sheets API down â†’ Gray squares, form still functional
2. Malformed date data in sheet â†’ Skip bad entries, show others
3. Very slow API response â†’ Loading state, then timeout to gray

### Success Metrics
- **Visual clarity**: Users can identify missing days at a glance
- **Performance**: Week indicator loads within 2 seconds 95% of the time
- **Reliability**: Core egg logging functionality unaffected by indicator failures
- **Usability**: No user confusion about the indicator's purpose

### Future Enhancements (Not Required for MVP)
- Show quantity indicators (small number overlay on green squares)
- Animation when today's square updates after submission

### Acceptance Criteria
- [ ] Week indicator displays 7 squares in correct chronological order
- [ ] Today's square has orange border, past days do not
- [ ] Green squares accurately reflect days with logged eggs
- [ ] Gray squares accurately reflect days without logged eggs  
- [ ] Indicator loads within 2 seconds on mobile network
- [ ] After successful egg submission, today's square updates to green
- [ ] App remains fully functional if week indicator API fails
- [ ] Visual design matches existing app theme (orange/yellow/black)
- [ ] Responsive layout works on mobile and desktop
- [ ] No performance impact on core egg logging functionality

### Notes for Developer
- Maintain the existing single-file HTML approach for frontend
- Reuse existing Google Sheets authentication patterns
- Follow the established dark theme and mobile-first design principles
- Ensure the feature enhances UX without adding complexity to core workflows
- Test thoroughly on Android Firefox (user's primary device)